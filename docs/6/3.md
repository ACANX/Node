## 抛出问题

细心或者有强迫症的朋友一定注意到了我们群晖的硬盘信息里面居然没有识别到我们的硬盘，明明我们已经插了 10 块硬盘了：

![](https://image.3001.net/images/20230223/16771284669844.png) 

这是因为我们的硬盘属于扩展硬盘，编号是从 7 开始的：

![](https://image.3001.net/images/20230223/16771286234611.png) 

而这个图标里面只识别板载硬盘，编号应该为 1、2、3、4 才可以正常显示。

## 解决方法

既然群晖只显示板载硬盘，那肯定还有小伙伴有疑问，不对啊，为啥我们的引导的硬盘是板载的没有识别呢？

![](https://image.3001.net/images/20230223/16771287159986.png) 

国光猜测是因为这个引导盘太小了，只能作为引导，群晖没把他当回事。

### 腾出 sata0

不过这个可恶的引导盘确实占了 sata0 的位置，我们待会给他改为 sata4 编号，这样就可以让 sata0、sata1、sata2、sata3 正常被群晖识别为板载硬盘了。 

 直接编辑虚拟机配置：

```bash
nano /etc/pve/qemu-server/100.conf
```

手动将 sata0 改为 sata4：

![](https://image.3001.net/images/20230223/16771289025487.png)  

### 添加 sata 0、1、2、3

我们这里需要再添加 4 块 SSD，当然 SSD 也不是白添加的，用来做缓存也是不错的选择。

关于 SSD 缓存有一些坑和基础知识得了解一下：

1. **SSD 写入放大问题**
	- **缓存要保留一定的未分配空间，建议分配 80%，防止写入放大**。是因为群晖的缓存自动释放速度很慢，当缓存占用率 99%后，会反复对一些块进行移除，写入，导致硬盘的健康度下降。
1. SSD 建议开启只读缓存
	- 只读缓存陈本很低，只需要 1 块硬盘，而读写缓存需要 2 块硬盘。
	- 读写缓存主要是在群晖用于网页服务，iscsi，虚拟机的情况下有较好的加速作用，提升效果有限。
	- 读写缓存是和存储空间并在一起的，也就是说如果 SSD 突然 GG，与读写缓存相连的这个存储空间会挂掉。
	- 大部分家用场景，做读缓存就够了，读写缓存没有任何帮助，反而增加了存储空间挂掉的风险。

根据上述知识点我们重新设计一下我们的硬盘结构：

![](https://image.3001.net/images/20230223/16771298295463.png) 

主要就添加了 4 个 PVE 的 125GB 虚拟 SSD，打算给存储池1、2、3、4 做 125 x 80% = 120GB SSD 缓存。另外直通的硬盘里面有 1 个 256GB 的小牌子 SATA  SSD 正好也可以直通给存储池 6 做 200GB 的 SSD 缓存。

下面是国光我添加硬盘勾选的一些参数：

![](https://image.3001.net/images/20230223/16771300579393.png) 

1. 勾选 「SSD 仿真」，必选。这样可以让群晖识别你为 SSD，从而才可以将其作为缓存盘。
2. 勾选 「丢弃」，可选，开启 SSD  TRIM 支持，也是一种先进的存储技术
3. 缓存类型选择为：「Write back」，是一个提高虚拟机 IO 的一种非常有效的参数

以此类推，添加完剩下 3 块硬盘：

![](https://image.3001.net/images/20230223/16771302766903.png) 

最后不要忘记修正一下我们现在的引导，已经从原来的 sata0 变为 sata4 了：

![](https://image.3001.net/images/20230223/16771305136604.png)   

## 最终效果

最终我们解决了群晖的硬盘信息里面识别不到我们硬盘的问题，强迫症狂喜：

![](https://image.3001.net/images/20230223/16771306556551.png) 

提示未初始化不要紧，我们参考下面的 SSD 缓存给他们都初始化一下： 

## SSD 缓存

既然添加了缓存就得利用起来，下面以存储池 1 为例来添加 SSD 缓存。先创建 SSD 缓存：

![](https://image.3001.net/images/20230223/16771307243597.png) 

然后给存储空间1装载加速一下：

![](https://image.3001.net/images/20230223/16771307881178.png) 

选择「只读缓存」：

![](https://image.3001.net/images/20230223/16771308187727.png) 

只有 1 个硬盘，这里选择「Basic」类型：

![](https://image.3001.net/images/20230223/1677130857917.png) 

选择我们要添加的 SSD：

![](https://image.3001.net/images/20230223/16771308882992.png) 

为了防止写入放大，这里分配大小为：125 x 80% = 120GB 大小：

![](https://image.3001.net/images/20230223/16771309293836.png) 

最终添加好的效果如下：

![](https://image.3001.net/images/20230223/16771309715838.png) 

以此类推，我们给其他存储池也添加对应的 SSD 缓存，最终强迫症终于舒服了：

![](https://image.3001.net/images/20230223/16771311843188.png) 

​    

然后再配置一下家目录：

![](https://image.3001.net/images/20230223/16771455776342.png) 

然后每个存储空间新建自己的对应的文件，最终的效果如下：

![](https://image.3001.net/images/20230223/1677145638277.png)  

